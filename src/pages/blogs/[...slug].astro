---
import { type CollectionEntry, getCollection, render } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';
import FormattedDate from '../../components/FormattedDate.astro';
import ScrollProgressBar from '../../components/ScrollProgressBar.astro';
import Prose from "../../components/Prose.astro";

export async function getStaticPaths() {
	const posts = await getCollection('blog');
	return posts.map((post) => ({
		params: { slug: post.id },
		props: post,
	}));
}
type Props = CollectionEntry<'blog'>;

const post = Astro.props;
const { Content, remarkPluginFrontmatter } = await render(post);

const { title, description, pubDate, updatedDate, heroImage } = post.data;
---

<BaseLayout title={title} description={description} image={heroImage}>
	<ScrollProgressBar />

	<main class="flex-1 px-6 py-16 md:py-24 relative overflow-hidden">

		<article class="max-w-4xl mx-auto">
			<!-- Back link -->
			<div class="mb-8">
				<a
					href="/blogs"
					class="inline-flex items-center gap-2 text-gray-600 dark:text-gray-400 hover:text-blue-600 dark:hover:text-blue-400 transition-colors font-medium"
				>
					<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
						<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
					</svg>
					Back to Blog
				</a>
			</div>

			<!-- Hero Image (if present) -->
			{heroImage && (
				<div class="mb-8 rounded-xl overflow-hidden">
					<img src={heroImage} alt={title} class="w-full h-auto" />
				</div>
			)}

			<!-- Article Header -->
			<header class="mb-16 space-y-6">
				<h1 class="text-4xl md:text-6xl font-black tracking-tight bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900 dark:from-gray-100 dark:via-gray-200 dark:to-gray-100 bg-clip-text text-transparent" style="font-family: 'Montserrat', sans-serif;">
					{title}
				</h1>

				{description && (
					<p class="text-xl md:text-2xl text-gray-600 dark:text-gray-400 leading-relaxed">
						{description}
					</p>
				)}

				<div class="flex items-center gap-4 text-sm text-gray-500 dark:text-gray-500 border-l-4 border-blue-500 pl-4">
					<FormattedDate date={pubDate} />
					{updatedDate && (
						<>
							<span>•</span>
							<div>
								Updated <FormattedDate date={updatedDate} />
							</div>
						</>
					)}
					{remarkPluginFrontmatter?.minutesRead && (
						<>
							<span>•</span>
							<span>{remarkPluginFrontmatter.minutesRead}</span>
						</>
					)}
					<span>•</span>
					<a
						href={`https://github.com/dealloc/website/issues/new?title=${encodeURIComponent(`Typo in "${title}"`)}&body=${encodeURIComponent(`I found a typo in the blog post:\n\n**Post:** ${title}\n**URL:** ${Astro.url.href}\n\n**Description:**\n<!-- Please describe the typo here -->`)}`}
						target="_blank"
						rel="noopener noreferrer"
						class="text-gray-500 dark:text-gray-500 hover:text-blue-600 dark:hover:text-blue-400 transition-colors"
					>
						Spotted a typo?
					</a>
				</div>
			</header>

			<!-- Article Content -->
			<Prose>
				<Content />
			</Prose>

			<!-- Back to top / Blog link -->
			<footer class="mt-16 pt-8 border-t border-gray-200 dark:border-gray-800">
				<a
					href="/blogs"
					class="inline-flex items-center gap-2 px-6 py-3 bg-gray-100 dark:bg-gray-900 hover:bg-gray-200 dark:hover:bg-gray-800 rounded-lg font-semibold transition-all hover:scale-105 hover:shadow-lg"
				>
					<span class="bg-gradient-to-r from-purple-600 to-purple-500 dark:from-purple-400 dark:to-purple-300 bg-clip-text text-transparent">
						← Back to All Posts
					</span>
				</a>
			</footer>
		</article>
	</main>
</BaseLayout>
